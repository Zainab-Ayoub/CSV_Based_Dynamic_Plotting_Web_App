<!DOCTYPE html>
<html>
<head>
    <title>CSV Plotter</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="p-4 bg-light">
<div class="container">
    <h2 class="mb-4">CSV-Based Dynamic Plotting App</h2>

    {% if error %}
        <div class="alert alert-danger">{{ error }}</div>
    {% endif %}

    <form action="/" method="POST" enctype="multipart/form-data">
        <div class="mb-3">
            <label for="csv_file" class="form-label">Upload CSV File:</label>
            <input type="file" name="csv_file" class="form-control" required>
        </div>
        <button type="submit" class="btn btn-primary">Upload</button>
    </form>

    {% if columns %}
        <hr>
        <form action="/plot" method="POST">
            <input type="hidden" name="filename" value="{{ filename }}">
            <div class="mb-3">
                <label for="x_column" class="form-label">Select X-Axis:</label>
                <select name="x_column" class="form-select" required>
                    {% for col in columns %}
                        <option value="{{ col }}">{{ col }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="mb-3">
                <label for="y_column" class="form-label">Select Y-Axis:</label>
                <select name="y_column" class="form-select" required>
                    {% for col in columns %}
                        <option value="{{ col }}">{{ col }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="mb-3">
                <label class="form-label">Select Graph Type:</label>
                <select name="plot_type" class="form-select">
                    <option value="line">Line</option>
                    <option value="bar">Bar</option>
                    <option value="scatter">Scatter</option>
                </select>
            </div>

            <button type="submit" class="btn btn-success">Generate Plot</button>
        </form>
    {% endif %}

    {% if image_file %}
        <hr>
        <h4>Preview (Top 10 Rows)</h4>
        <table class="table table-bordered">
            <thead>
                <tr><th>{{ x_col }}</th><th>{{ y_col }}</th></tr>
            </thead>
            <tbody>
                {% for x, y in zip(preview_x, preview_y) %}
                    <tr><td>{{ x }}</td><td>{{ y }}</td></tr>
                {% endfor %}
            </tbody>
        </table>

        <h4 class="mt-4">Generated Plot</h4>
        <img src="{{ url_for('static', filename=image_file) }}" class="img-fluid mb-3" alt="Plot">

        <a href="/download" class="btn btn-outline-primary">Download Plot</a>
        <a href="/" class="btn btn-secondary ms-2">Reset</a>
    {% endif %}
</div>
</body>
</html>
